# generic metadata
prefect-version: null
name: null

# preparation steps
build: null
push: null

# runtime steps
pull:
  # - prefect.deployments.steps.run_shell_script:
  #     id: get-github-token
  #     script: uv run prefect-cloud github token Bafbi/projet-m2-bi
  # - prefect.deployments.steps.git_clone:
  #     id: git-clone
  #     branch: main
  #     repository: https://x-access-token:{{ get-github-token.stdout }}@github.com/Bafbi/projet-m2-bi.git
  - prefect.deployments.steps.git_clone:
      id: git-clone
      branch: main
      repository: https://github.com/Bafbi/projet-m2-bi.git
  - prefect.deployments.steps.run_shell_script:
      script: uv pip install -r requirements.txt
      directory: "{{ git-clone.directory }}"

# deployment configurations
deployments:
- # base metadata
  name: pipeline-dev
  version: null
  tags: ["dbt", "test"]
  description: "Test dbt debug flow"
  schedule: null

  # flow-specific fields
  entrypoint: prefect_flows/pipeline.py:dbt_full_pipeline
  parameters: {}

  # infra-specific fields
  work_pool:
    name: default-work-pool
    work_queue_name: default
    job_variables:
      env:
        PREFECT_CLOUD_API_URL: "https://api.prefect.cloud/api/accounts/5b70ef3b-f84d-4d7b-b424-543bb43209bd/workspaces/870a72e9-73a9-492c-972e-c176dc07a574"
      image: "prefecthq/prefect-client:3-python3.12"

  name: pipeline-prod
  entrypoint: prefect_flows/pipeline.py:dbt_full_pipeline
  parameters: {}
  tags: ["dbt", "prod"]
  description: "Pipeline dbt complet pour prod"
  schedule: null
  work_pool:
    name: default-work-pool
    work_queue_name: default
    job_variables:
      env:
        PREFECT_CLOUD_API_URL: "https://api.prefect.cloud/api/accounts/5b70ef3b-f84d-4d7b-b424-543bb43209bd/workspaces/870a72e9-73a9-492c-972e-c176dc07a574"
      image: "prefecthq/prefect-client:3-python3.12"